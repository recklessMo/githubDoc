### 消息队列终极总结

使用场景：

1. 业务解耦合（审核这边耦合私信服务很严重，私信服务出问题导致审核暂停）
2. 最终一致性（对于非强依赖的服务，可以进行最终一致性操作，是主流程尽可能的精简）（但是适用于一定能成功的场景）
3. 广播（通过exchange机制，可以广播发送到多个queue，不用每次来个感兴趣的业务方都对接一遍）
4. 错峰（当上下游服务的速率不匹配的时候可以进行错峰）
5. 流控（流量控制，当流量超过处理能力的时候慢慢处理，不至于拖垮）



几个影响业务的问题：

（生产者）消息是否能可靠投递，也就是不丢消息不凭空产生：（保证消息不丢失，并且消息也不会凭空产生，例子，如果把消息发送的代码写在本地事务里面-事务嵌套远程调用，这是大忌，有可能出现长事务锁死的问题，如果消息在返回途中发生超时异常，那么本地回滚，消息就凭空产生了，bad，解决方案是本地数据库落地消息内容，然后不断发起重试，直到成功，缺点是会产生重复消息）

（生产者）消息是否能保证顺序：不能完全避免，因为有消息重发机制存在，两个消息可能由不同的线程处理。

消息是否能可靠存储：

消息是否能可靠送达（消费者处理失败怎么办，reject之后怎么办，怎么重试，怎么保证不乱序）





