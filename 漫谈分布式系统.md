### 漫谈分布式系统

常见的分布式系统分类：

1. 分布式存储系统（zk）
2. 分布式计算系统（hadoop等，spark，storm）



分布式一般是不同的节点内容不太一致，像平时后端部署多个服务一般叫集群！



这就是我们平常所说的分布式系统！做好分类还是很必要的，比如服务一般无状态，所以不需要保证一致性



分布式存储是分布式系统里面最难，最复杂，涉及面最广的问题。大致分为四个方面：

1. 结构化存储-   关系型数据库rdbms，mysql
2. 非结构化存储-   分布式文件系统hdfs，gfs等，随机性能差
3. 半结构化存储-   nosql：bigtable，dynamo，cassandra。leveldb，lsm tree
4. in-memory-   redis集群





CAP PAXOS ZAB MYSQL

cap介绍：https://my.oschina.net/lhztt/blog/915533

https://www.zhihu.com/question/54105974/answer/139037688

CAP最简单明了的解释：
首先说明为什么我们需要分布式系统：最核心的就是容错和性能

1. 因为单机会有瓶颈，存储和性能瓶颈。（性能）

2. 单机存在着单点，并不可靠。（容错）

   ​

所以我们需要分布式系统。在一个提供存储服务的分布式系统上，什么是CAP呢？

1. 由于在一个分布式系统里面，各个节点之间的网络本来应该是连通的，但是由于某些原因导致某些节点之间的网络不连通了，整个网络就分成了几个区域，这就是分区。
2. 如果一个数据项只在一个节点中保存，那么当该节点出现分区之后，和这个节点不连通的部分就访问不到这个数据了，这就叫分区不能容忍。
3. 提高分区容忍性的办法就是将一个数据项复制到多个节点上，这样同样一份数据就可以分部到各个区里面。当出现分区的时候也能很好的提供服务。容忍性提高了。
4. 然而，数据复制了多份，那么如何保证这些数据的一致性就成了问题。要保证强一致性，那么每次写操作需要等待全部节点写成功，但是由于跨网络调用，所以很可能出现写不成功的问题。这样就造成了系统的不可用。

总体就是，数据存在的节点越多，分区容忍性就越高，但是要复制的数据就越多，一致性就越难保证，为了保证一致性，那么在更新的时候所需要的时间就越长，可用性就越低。



组复制：（mysql半同步复制，异步复制，在保证P的基础上，CA做权衡）

PAXOS协议的应用点：mysql组复制？什么原理呢？

有点像zk

当一个事务在一个节点上提交之前，会在组内自动进行原子性的广播，告知其他节点变更了什么内容/执行了什么事务，然后为该事物建立一个全局的排序，最终，这意味着所有的服务器都以相同的顺序接收相同的事务集。因此，所有服务器都按照相同的顺序应用相同的变更集，因此它们在组中保持一致



分布式系统必须具有分区容错性，于是乎数据需要进行镜像，也就是多副本。那么如何保证多副本的数据一致性就成为了很关键的内容。

paxos协议的介绍和证明：http://www.infoq.com/cn/articles/wechat-paxosstore-paxos-algorithm-protocol

quorum协议：

